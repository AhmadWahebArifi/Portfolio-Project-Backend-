<div class="d-flex justify-content-between align-items-center mb-4">
  <h2><i class="fas fa-envelope"></i> Contact Messages</h2>
  <div class="btn-group">
    <a
      href="/admin/contacts"
      class="btn btn-outline-secondary <%= selectedStatus === '' ? 'active' : '' %>"
      >All</a
    >
    <a
      href="/admin/contacts?status=new"
      class="btn btn-outline-danger <%= selectedStatus === 'new' ? 'active' : '' %>"
      >New</a
    >
    <a
      href="/admin/contacts?status=read"
      class="btn btn-outline-warning <%= selectedStatus === 'read' ? 'active' : '' %>"
      >Read</a
    >
    <a
      href="/admin/contacts?status=replied"
      class="btn btn-outline-success <%= selectedStatus === 'replied' ? 'active' : '' %>"
      >Replied</a
    >
  </div>
</div>

<div class="admin-card">
  <div class="card-header bg-transparent border-0 py-3">
    <h6 class="mb-0">Total Messages: <%= totalCount %></h6>
  </div>

  <% if (contacts.length > 0) { %>
  <div class="table-responsive">
    <table class="table table-hover">
      <thead>
        <tr>
          <th>Contact</th>
          <th>Subject</th>
          <th>Status</th>
          <th>Priority</th>
          <th>Date</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <% contacts.forEach(function(contact) { %>
        <tr class="<%= contact.status === 'new' ? 'table-warning' : '' %>">
          <td>
            <div>
              <h6 class="mb-0"><%= contact.name %></h6>
              <small class="text-muted">
                <i class="fas fa-envelope"></i> <%= contact.email %> <% if
                (contact.phone) { %> <br /><i class="fas fa-phone"></i> <%=
                contact.phone %> <% } %>
              </small>
            </div>
          </td>
          <td>
            <div>
              <strong><%= contact.subject %></strong>
              <br />
              <small class="text-muted"
                ><%= contact.message.substring(0, 60) %>...</small
              >
            </div>
          </td>
          <td>
            <span
              class="badge bg-<%= contact.status === 'new' ? 'danger' : contact.status === 'read' ? 'warning' : contact.status === 'replied' ? 'success' : 'secondary' %>"
            >
              <%= contact.status.toUpperCase() %>
            </span>
          </td>
          <td>
            <span
              class="badge bg-<%= contact.priority === 'urgent' ? 'danger' : contact.priority === 'high' ? 'warning' : 'secondary' %>"
            >
              <%= contact.priority.toUpperCase() %>
            </span>
          </td>
          <td>
            <small class="text-muted">
              <%= moment(contact.createdAt).format('MMM DD, YYYY HH:mm') %>
            </small>
          </td>
          <td>
            <div class="btn-group btn-group-sm">
              <a
                href="/admin/contacts/<%= contact.id %>"
                class="btn btn-outline-info"
                title="View"
              >
                <i class="fas fa-eye"></i>
              </a>
              <form
                action="/admin/contacts/<%= contact.id %>?_method=DELETE"
                method="POST"
                class="d-inline"
                onsubmit="return confirm('Are you sure you want to delete this message?')"
              >
                <button
                  type="submit"
                  class="btn btn-outline-danger"
                  title="Delete"
                >
                  <i class="fas fa-trash"></i>
                </button>
              </form>
            </div>
          </td>
        </tr>
        <% }); %>
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  <% if (totalPages > 1) { %>
  <div class="card-footer bg-transparent">
    <nav>
      <ul class="pagination justify-content-center mb-0">
        <% if (currentPage > 1) { %>
        <li class="page-item">
          <a
            class="page-link"
            href="/admin/contacts?page=<%= currentPage - 1 %><%= selectedStatus ? '&status=' + selectedStatus : '' %>"
            >Previous</a
          >
        </li>
        <% } %> <% for (let i = Math.max(1, currentPage - 2); i <=
        Math.min(totalPages, currentPage + 2); i++) { %>
        <li class="page-item <%= i === currentPage ? 'active' : '' %>">
          <a
            class="page-link"
            href="/admin/contacts?page=<%= i %><%= selectedStatus ? '&status=' + selectedStatus : '' %>"
            ><%= i %></a
          >
        </li>
        <% } %> <% if (currentPage < totalPages) { %>
        <li class="page-item">
          <a
            class="page-link"
            href="/admin/contacts?page=<%= currentPage + 1 %><%= selectedStatus ? '&status=' + selectedStatus : '' %>"
            >Next</a
          >
        </li>
        <% } %>
      </ul>
    </nav>
  </div>
  <% } %> <% } else { %>
  <div class="card-body text-center py-5">
    <div class="mb-3">
      <i class="fas fa-inbox fa-3x text-muted"></i>
    </div>
    <h5>No Messages Found</h5>
    <p class="text-muted">No contact messages to display.</p>
  </div>
  <% } %>
</div>
